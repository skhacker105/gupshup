<div class="message-bubble" [appLongPress]="true" (modeSwitched)="longPress.emit()"
    [ngClass]="{
        'sent': isSent,
        'received': !isSent,
        'selected': isSelected,
        'multi-select': multiSelectMode,
        'mobile': isMobile,
        'tablet': isTablet,
        'desktop': isDesktop
        }"
    (click)="onMessageClick($event)">

    <!-- Checkbox for multi-select -->
    <input type="checkbox" *ngIf="multiSelectMode" [checked]="isSelected" (change)="onSelectionChange($event)"
        class="message-checkbox">

    <!-- Message content -->
    <div class="message-content">
        <!-- Sender name for received messages -->
        <div *ngIf="!isSent && showSenderName" class="sender-name">{{ senderName }}</div>

        <!-- Reply indicator -->
        <div *ngIf="message.replyTo" class="reply-indicator">
            <i class="fa fa-reply"></i>
            <span>{{ repliedToText || '(Media)' }}</span>
        </div>

        <!-- Main message text or attachment -->
        <div *ngIf="message.text" class="message-text">
            {{ message.text }}
            <span *ngIf="message.translatedText" class="translated-text">(Translated: {{ message.translatedText
                }})</span>
        </div>

        <!-- Attachments -->
        <div *ngIf="documentFile" class="attachment">
            <div *ngIf="isImage" class="image-attachment">
                <img [src]="fileURL" [alt]="documentFile.name" (click)="onImageClick()">
                <div class="attachment-overlay">
                    <button (click)="onDownload($event)" class="btn-download"><i class="fa fa-download"></i></button>
                    <button (click)="onForward($event)" class="btn-forward"><i class="fa fa-share"></i></button>
                </div>
            </div>
            <div *ngIf="isVideo" class="video-attachment">
                <video [src]="fileURL" controls (click)="onVideoClick()"></video>
                <div class="attachment-overlay">
                    <button (click)="onDownload($event)" class="btn-download"><i class="fa fa-download"></i></button>
                </div>
            </div>
            <div *ngIf="isDocument" class="document-attachment">
                <i [ngClass]="getDocumentIcon()"></i>
                <span>{{ documentFile.name }}</span>
                <button (click)="onDownload($event)" class="btn-download"><i class="fa fa-download"></i></button>
            </div>
            <div *ngIf="isAudio" class="audio-attachment">
                <audio [src]="fileURL" controls></audio>
                <button (click)="onPlay($event)" class="btn-play"><i class="fa fa-play"></i></button>
            </div>
        </div>

        <!-- Timestamp -->
        <div class="message-time">
            {{ message.createdAt | date:'shortTime' }}
            <span *ngIf="isSent && message.status === 'sent'" class="status-icon">
                <i class="fa fa-check"></i><i class="fa fa-check"></i>
            </span>
        </div>
    </div>

    <!-- Message actions -->
    <div class="message-actions" *ngIf="!multiSelectMode">
        <button (click)="onTranslate($event)" *ngIf="message.text && !message.translatedText" title="Translate">
            <i class="fa fa-language"></i>
        </button>
        <button (click)="onReply($event)" title="Reply">
            <i class="fa fa-reply"></i>
        </button>
        <button (click)="onForward($event)" title="Forward">
            <i class="fa fa-share"></i>
        </button>
        <button (click)="onDelete($event)" title="Delete">
            <i class="fa fa-trash"></i>
        </button>
        <button (click)="onInfo($event)" title="Info">
            <i class="fa fa-info-circle"></i>
        </button>
    </div>
</div>