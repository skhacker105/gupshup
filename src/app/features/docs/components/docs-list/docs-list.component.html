<!-- src/app/components/docs-list/docs-list.component.html -->
<app-layout title="Documents" [selectionMode]="multiSelectMode" [isPopup]="false" [isMobile]="appService.isMobile"
    [isTablet]="appService.isTablet" [isDesktop]="appService.isDesktop" (cancelMultiSelect)="cancelMultiSelect()"
    (swipeRight)="enableMobileMultiSelect()">

    <!-- Always visible actions -->
    <ng-container action-always></ng-container>

    <!-- Singular mode actions -->
    <ng-container action-singular>

        <!-- Delete Current Folder -->
        <button (click)="deleteFolder(currentFolder, $event)" title="Delete Current Folder" [disabled]="!currentFolder">
            <i class="fa-solid fa-trash"></i>
            <span class="no-wrap" *ngIf="!appService.isMobile">Delete Folder</span>
        </button>

        <!-- New File -->
        <button (click)="addNewFile()" title="Create a new file">
            <i class="fa-solid fa-file-circle-plus"></i>
            <span class="no-wrap" *ngIf="!appService.isMobile">Add File</span>
        </button>

        <!-- New Folder -->
        <button (click)="createFolder()" title="Create a new folder">
            <i class="fa fa-folder-plus"></i>
            <span class="no-wrap" *ngIf="!appService.isMobile">Add Folder</span>
        </button>
    </ng-container>

    <!-- Multi-select mode actions -->
    <ng-container action-multiselect>
        <button (click)="deleteSelected()" [disabled]="selectedItems.length === 0" title="Delete selected">
            <i class="fa fa-trash"></i>
            <span class="no-wrap" *ngIf="!appService.isMobile">Delete</span>
        </button>
    </ng-container>

    <!-- Error -->
    <p *ngIf="errorMessage" class="error">{{ errorMessage }}</p>

    <!-- Body -->
    <div class="docs-list" *ngIf="!loading; else loadingSpinner">

        <!-- Group By / Order By / Sizes -->
        <div class="filter-header">

            <!-- Group By -->
            Group:
            <select [(ngModel)]="documentService.selectedGroupBy" (change)="loadItems()" class="orderby-select"
                [ngClass]="{'mobile': appService.isMobile}">
                <option value="">None</option>
                <option value="type">Type</option>
                <option value="month">Month</option>
                <option value="sender">Sender</option>
                <option value="receiver">Receiver</option>
            </select>

            <!-- Order By -->
            Order:
            <select [(ngModel)]="documentService.selectedOrderBy" (change)="loadItems()" class="orderby-select"
                [ngClass]="{'mobile': appService.isMobile}">
                <option value="">None</option>
                <option value="createdDate">Date</option>
                <option value="name">Name</option>
                <option value="senderId">Sender</option>
                <option value="receiverId">Receiver</option>
            </select>

            <!-- Icon Size -->
            Size:
            <select [(ngModel)]="documentService.selectedIconSize" class="orderby-select" [ngClass]="{'mobile': appService.isMobile}">
                <option *ngFor="let size of iconSizes" [value]="size">{{size | titlecase}}</option>
            </select>
        </div>

        <!-- Breadcrumb Navigation -->
        <app-breadcrumb *ngIf="!documentService.selectedGroupBy" [pathSegments]="pathSegments" (segmentClick)="navigateToPath($event)"></app-breadcrumb>

        <!-- Non-grouped view -->
        <div *ngIf="!documentService.selectedGroupBy" class="grid-container">
            <app-document-folder-icon *ngFor="let item of items" [item]="item" [size]="documentService.selectedIconSize"
                [selectionMode]="multiSelectMode" [selected]="isSelected(item)" (onClick)="rowClick(item, $event)"
                [isDesktop]="appService.isDesktop" [isTablet]="appService.isTablet" [isMobile]="appService.isMobile">
            </app-document-folder-icon>
        </div>

        <!-- Grouped view -->
        <div *ngIf="documentService.selectedGroupBy" class="grid-container">
            <div *ngFor="let group of groups" class="group">
                <h3 class="group-key" [ngClass]="documentService.selectedIconSize">
                    <ng-container *ngIf="multiSelectMode">
                        <input type="radio" [checked]="isGroupSelected(group.groupKey)" 
                               (click)="onGroupRadioClick(group, $event)" 
                               class="radio-btn">
                      </ng-container>
                      
                    {{ group.groupKey }}
                </h3>
                <div class="group-files">
                    <app-document-folder-icon *ngFor="let doc of group.documents" [item]="doc" [size]="documentService.selectedIconSize"
                        [selectionMode]="multiSelectMode" [selected]="isSelected(doc)" (onClick)="rowClick(doc, $event)"
                        [isDesktop]="appService.isDesktop" [isTablet]="appService.isTablet" [isMobile]="appService.isMobile">
                    </app-document-folder-icon>
                </div>
            </div>
        </div>
    </div>

    <ng-template #loadingSpinner>
        <div class="spinner"><i class="fa fa-spinner fa-spin"></i> Loading documents...</div>
    </ng-template>
</app-layout>